type: custom:apexcharts-card
grid_options:
  columns: full
header:
  title: Stromerzeugung mit PV-Anlage – Messwerte und Prognose (Solar Forecast ML)
  show: true
  standard_format: true
  show_states: true
  colorize_states: true
apex_config:
  chart:
    height: 250px
  tooltip:
    enabled: true
    shared: true
    followCursor: true
graph_span: 0.999d
now:
  show: true
  color: blue
  label: jetzt
span:
  start: day
  offset: "-0day"
all_series_config:
  type: area
  opacity: 0.9
  stroke_width: 1
yaxis:
  - id: kW
    show: true
    min: 0
    apex_config:
      tickAmount: 5
  - id: capacity
    show: true
    opposite: true
    decimals: 0
    max: 100
    min: 0
    apex_config:
      rotate: 90
      tickAmount: 5
  - id: header_only
    show: false
series:
  - entity: sensor.senec_battery_charge_percent
    name: Batterie
    float_precision: 0
    type: area
    color: green
    stroke_width: 2
    opacity: 0.05
    yaxis_id: capacity
    extend_to: now
    show:
      legend_value: true
      in_header: false
    group_by:
      func: last
      duration: 5m
  - entity: sensor.senec_house_power
    name: Verbrauch
    float_precision: 3
    type: area
    color: red
    stroke_width: 2
    opacity: 0.1
    yaxis_id: kW
    unit: kW
    transform: return x/1000;
    extend_to: now
    show:
      legend_value: true
      in_header: false
    group_by:
      func: avg
      duration: 5m
  - entity: sensor.senec_solar_generated_power
    name: Solarerzeugung
    float_precision: 3
    color: orange
    stroke_width: 2
    opacity: 0.6
    yaxis_id: kW
    unit: kW
    transform: return x/1000;
    extend_to: now
    show:
      legend_value: true
      in_header: false
    group_by:
      func: avg
      duration: 5m
  - entity: sensor.solar_forecast_ml_next_hour_forecast
    name: SFML aktuell
    float_precision: 3
    type: line
    color: blue
    stroke_width: 2
    opacity: 0.6
    yaxis_id: kW
    unit: kW
    extend_to: false
    show:
      legend_value: true
      in_header: false
    group_by:
      func: avg
      duration: 5m
  - entity: sensor.solar_forecast_ml_next_hour_forecast
    name: SFML Prognose
    extend_to: false
    color: grey
    opacity: 0.3
    stroke_width: 2
    yaxis_id: kW
    show:
      legend_value: false
      in_header: false
    data_generator: |
      var today = new Date();
      var points = entity.attributes.hours_list.map((entry) => {
        var parts = entry.time.split(':');
        var date = new Date(today.getFullYear(), today.getMonth(), today.getDate(), parseInt(parts[0]), parseInt(parts[1]));
        return [date, entry.kwh];
      });
      if (points.length > 0) {
        points.unshift([new Date(), points[0][1]]);
      }
      return points;
  - entity: sensor.none_expected_daily_production
    yaxis_id: header_only
    name: Prognose heute
    float_precision: 1
    unit: " kWh"
    show:
      legend_value: true
      in_header: true
      in_chart: false
  - entity: sensor.tt_solar_generated
    yaxis_id: header_only
    name: Heute bis jetzt
    float_precision: 1
    color: orange
    show:
      legend_value: true
      in_header: true
      in_chart: false
  - entity: sensor.solar_forecast_ml_next_hour_forecast
    yaxis_id: header_only
    name: Nächste Stunde
    float_precision: 1
    unit: " kWh"
    show:
      legend_value: true
      in_header: true
      in_chart: false
  - entity: sensor.none_forecast_today_remaining
    yaxis_id: header_only
    name: Prognose heute Rest
    float_precision: 1
    unit: " kWh"
    show:
      legend_value: true
      in_header: true
      in_chart: false
  - entity: sensor.none_forecast_tomorrow
    yaxis_id: header_only
    name: Prognose morgen
    float_precision: 1
    unit: " kWh"
    show:
      legend_value: true
      in_header: true
      in_chart: false
  - entity: sensor.none_energy
    yaxis_id: header_only
    name: Prognose übermorgen
    float_precision: 1
    unit: " kWh"
    show:
      legend_value: true
      in_header: true
      in_chart: false
